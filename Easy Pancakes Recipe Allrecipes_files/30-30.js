(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{178:function(e,t,a){"use strict";a.r(t);var n=a(1),o=a.n(n),r=a(905),i=a(773),s=o()(document.body);function c(e,t,a){var n=Object(i.a)("/element-api/content-proxy/favorite"),s=o()(".component.favorite");o()(t).closest(s).addClass("saving"),o.a.post(n,e,(function(e){JSON.parse(e).recipeBoxItemID&&(o()(t).find(".icon-text").html("Saved"),o()(t).closest(s).addClass("saved"),o()(t).closest(s).removeClass("saving"))})).fail((function(n){o()(t).closest(s).removeClass("saving"),500!==n.status||a||Object(r.a)(c,[e,t])}))}t.default=function(){var e=o()(".saveMe.shareicon-favorite-link");o()(document).on("click",".saveMe.shareicon-favorite-link",(function(t){var a=t.currentTarget;if(o()(a).is(".saveMe.shareicon-favorite-link"))if(t.preventDefault(),s.hasClass("authenticated")&&!e.hasClass("saving")){c({id:o()(a).data("content-id")},a)}else{var n=o()(a).data("content-login-url")+"?actionsource=search&loginreferrerurl="+window.location.pathname+window.location.search;setTimeout((function(){window.open(n,"_self")}),0)}}))}},280:function(e,t,a){"use strict";a.r(t);var n=a(1),o=a.n(n),r=a(5),i=a.n(r),s=a(4),c=a(778),u=a(773),l=a(905);function d(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t){e[0].target.classList.contains("authenticated")&&sessionStorage.removeItem("commentLogin"),e[0].target.classList.contains("modal-active")&&(sessionStorage.removeItem("ratingValue"),t.disconnect())}function g(e){var t=sessionStorage.getItem(e),a=document.querySelector(".ugc-comments-content-container");if(t&&a){var n=a.getBoundingClientRect().top-document.querySelector("header.navigation-test").offsetHeight;window.scrollBy(0,n),function(e){var t=sessionStorage.getItem(e),a=document.getElementById("project-ratings");t&&a&&(o()(".ugc-comments-add-comment").trigger("click"),document.querySelector(".ugc-upload-modal").querySelector("input[value=".concat(t,"]")).checked=!0)}("ratingValue"),new MutationObserver(m).observe(document.body,{attributes:!0})}}var f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$context=t,this.$modal=t.closest(".partial.modal"),this.$form=t.find("form"),this.$alert=t.find(".alert-banner");var a=t.closest(".ugc-upload-reply-modal");a.length?(this.$trigger=o()(".ugc-comments-reply-button"),this.ugcUploadModal=new c.a(a,"ugc-upload-reply-modal")):(this.$trigger=o()(".recipe-review-add-review, .ugc-comments-add-comment, .ugc-photos-upload-photo"),this.ugcUploadModal=new c.a(t.closest(".ugc-upload-modal"),"ugc-upload-modal")),this.useUGCManager=!!this.$form.closest(".ugc-upload").data("ugc-manager")&&this.$form.closest(".ugc-upload").data("ugc-manager"),this.ugcType=this.$trigger.hasClass("recipe-review-add-review")&&!this.useUGCManager?"review":"comments",g("commentLogin")}var t,a,n;return t=e,(a=[{key:"showError",value:function(e){this.$alert.removeClass("hidden"),this.$alert.find(".alert-text").text(e)}},{key:"hideError",value:function(){this.$alert.addClass("hidden"),this.$alert.find(".alert-text").text("")}},{key:"uploadComment",value:function(e,t){var a=this,n=Object(u.a)("/element-api/content-proxy/comment"),r=e;r.title=this.$context.data("headline"),(r.text||r.rating)&&o.a.post(n,r,(function(e,t){if("success"===t){a.$context.addClass("submitted"),a.$modal.addClass("success"),a.hideError();var n=o()("textarea",a.$form);n.length&&n.val(""),r.text&&i()(s.hc).broadcast(e,r),r.rating&&i()(s.ic).broadcast(e,r)}})).fail((function(n){500!==n.status||t?a.showError("An error has occurred."):500!==n.status||t||Object(l.a)(a.uploadComment.bind(a),[e])}))}},{key:"uploadReview",value:function(e,t){var a=this,n=Object(u.a)("/element-api/content-proxy/review");o.a.post(n,e,(function(t,n){if("success"===n){a.$context.addClass("submitted"),a.$modal.addClass("success");var o={label:"Rating Submitted"};e.text&&(o.label="Review Submitted"),i()(s.ec).broadcast(o),a.hideError()}})).fail((function(n){500!==n.status||t?a.showError("An error has occurred."):500!==n.status||t||Object(l.a)(a.uploadReview.bind(a),[e])}))}},{key:"events",value:function(){var e=this;document.body.addEventListener(s.e,(function(t){var a=sessionStorage.getItem("ratingValue"),n=sessionStorage.getItem("commentLogin"),o=sessionStorage.getItem("userRecipeLogin");(a||n||o)&&setTimeout(i()(s.lc).broadcast(t,e.$trigger),0)})),i()(s.lc).subscribe((function(t,a){if(o()("body").hasClass("authenticated"))t.preventDefault(),e.pid=a.data("tid")?a.data("tid"):"0","review"===e.ugcType&&e.$form.trigger("reset"),e.$context.removeClass("submitted"),e.$modal.removeClass("success"),e.hideError(),e.ugcUploadModal.open(),i()(s.Lb).broadcast(e.ugcUploadModal.$modal,a.closest(".rating-star").data("rating")),window.ugcUploadModal=e.ugcUploadModal;else if(sessionStorage.setItem("commentLogin",!0),!a.closest(".embedded-auth-modal-trigger").length){var n=a.closest(e.$trigger).data("login-url")||a.data("login-url")||a.closest("button").data("login-url");window.open(n,"_self")}})),i()(s.o).subscribe((function(t,a){a.closest(e.$trigger).length&&i()(s.lc).broadcast(t,a),a.hasClass("embedded-auth-modal-trigger")&&a.hasClass("ugc-upload-button")&&sessionStorage.setItem("userRecipeLogin",!0)})),i()(s.Qb).subscribe((function(t,a){if(a.closest(e.$form).length){t.preventDefault();var n=e.$form.find("input[name=ugc-rating]:checked").val()||e.$form.find("input[name=ugc-comments-rating]:checked").val(),r=n,i=e.$form.find("textarea[name=ugc-text]").val()?e.$form.find("textarea[name=ugc-text]").val():"",s=e.$form.closest(".ugc-upload"),c=s.data("review"===e.ugcType?"cms-id":"uuid"),u=s.data("ugc-type")||"ugc-comment",l=e.$context.find(".ugc-upload-rating").length,d=e.pid,m=o()("body")[0].className.match(/(^|\s+)template-(\S*)/)[2];n&&c&&"review"===e.ugcType?e.uploadReview({rating:n,text:i,id:c}):l&&!n||!c?e.showError("Please select a rating."):i||l?e.uploadComment({rating:n,level_of_difficulty:r,text:i,id:c,pid:d,_type:u,template:m}):e.showError("Please enter a comment.")}}))}},{key:"init",value:function(){this.events()}}])&&d(t.prototype,a),n&&d(t,n),e}();t.default=function(){o()(".component.ugc-upload").each((function(){new f(o()(this)).init()}))}},773:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(2),o=a.n(n),r=a(1),i=a.n(r);function s(e){return i()(document.body).data("add-slash")&&!o.a.endsWith(e,"/")?"".concat(e,"/"):e}},905:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(2),o=a.n(n),r=a(1),i=a.n(r),s=a(773);function c(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return u(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function l(e,t){var a=Object(s.a)("/element-api/content-proxy/refresh-cookie");i.a.ajax({url:a,retry:!1,type:"GET",timeout:3e3,xhrFields:{withCredentials:!0},success:function(a){o.a.isArray(a)&&"function"==typeof e&&(o.a.forEach(a,(function(e){document.cookie=e})),e.apply(void 0,c(t).concat([!0])))}})}}}]);
//# sourceMappingURL=30-30.js.map